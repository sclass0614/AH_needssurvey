<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>우리집데이케어센터 욕구조사</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script src="supabase.js"></script>
    <script type="module" src="https://sclass0614.github.io/authCheck/authCheck.js"></script>
</head>

<body>
    <div class="header">
        <h1>우리집데이케어센터 욕구조사_전체조사</h1>
    </div>
    <div class="header-spacer"></div>
    <div class="survey-container" id="surveyContent">
        <div class="info-section" id="infoSection">
            <div class="info-row" id="memberInfoRow">
                <div class="info-group" id="memberNumberGroup">
                    <label class="info-label" id="memberNumberInfoLabel">회원번호</label>
                    <input type="text" id="entrymembernumber" class="info-input" readonly placeholder="회원번호를 입력하세요">
                </div>
                <div class="info-group" id="memberNameGroup">
                    <label class="info-label" id="memberNameInfoLabel">회원명</label>
                    <input type="text" class="info-input" id="entrymembername" readonly placeholder="회원번호 클릭하세요">
                </div>
            </div>
            <div class="info-row" id="employeeInfoRow">
                <div class="info-group" id="employeeNumberGroup">
                    <label class="info-label" id="employeeNumberInfoLabel">직원번호</label>
                    <input type="text" class="info-input" id="entryemployeenumber" readonly placeholder="직원번호를 입력하세요">
                </div>
                <div class="info-group" id="employeeNameGroup">
                    <label class="info-label" id="employeeNameInfoLabel">직원명</label>
                    <input type="text" class="info-input" id="entryemployeename" readonly placeholder="직원번호를 클릭하세요">
                </div>
            </div>
        </div>

        <div class="survey-container" id="surveyContentContainer">
        </div>
    </div>
    <div class="page-number" id="pageNumber"></div>

    <div id="loadingOverlay">
        <div class="loader"></div>
        <div>데이터를 처리중입니다...</div>
    </div>

    <div class="modal-overlay" id="customModal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">알림</div>
                <div class="modal-close">&times;</div>
            </div>
            <div class="modal-body" id="modalMessage">
            </div>
            <div class="modal-footer">
                <button class="modal-btn" id="modalConfirmBtn">확인</button>
            </div>
        </div>
    </div>

    <div id="memberSelectModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">회원 선택</div>
                <div class="modal-close" id="memberModalClose">&times;</div>
            </div>
            <div class="modal-body">
                <div class="modal-search">
                    <input type="text" id="memberSearchInput" placeholder="회원번호 또는 이름으로 검색..."
                        onkeyup="searchMembers()">
                </div>
                <div class="modal-list" id="memberList">
                    <div class="no-items">회원 정보를 불러오는 중...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel-btn" id="cancelMemberSelectBtn">취소</button>
                <button class="modal-btn" id="selectMemberBtn">선택</button>
            </div>
        </div>
    </div>

    <div id="employeeSelectModal" class="modal-overlay" style="display: none;">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">직원 선택</div>
                <div class="modal-close" id="employeeModalClose">&times;</div>
            </div>
            <div class="modal-body">
                <div class="modal-search">
                    <input type="text" id="employeeSearchInput" placeholder="직원번호 또는 이름으로 검색..."
                        onkeyup="searchEmployees()">
                </div>
                <div class="modal-list" id="employeeList">
                    <div class="no-items">직원 정보를 불러오는 중...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn cancel-btn" id="cancelEmployeeSelectBtn">취소</button>
                <button class="modal-btn" id="selectEmployeeBtn">선택</button>
            </div>
        </div>
    </div>

    <div class="control-panel" id="controlPanel">
        <div class="control-panel-header" id="controlPanelHeader" onclick="togglePanel()">
            <span id="controlPanelTitle">추가작업</span>
            <span class="toggle-icon" id="toggleIcon">▼</span>
        </div>
        <div class="control-panel-body" id="controlPanelBody">
            <div class="survey-type-selector" id="surveyTypeSelector">
                <button class="btn btn-survey-type" id="requiredSurveyBtn" onclick="openRequiredSurvey()">필수조사</button>
                <button class="btn btn-survey-type active" id="fullSurveyBtn" onclick="openFullSurvey()">전체조사</button>
            </div>
            <div class="control-panel-row" id="memberNumberRow">
                <label class="control-panel-label" id="memberNumberLabel">회원번호</label>
                <input type="text" id="entrymembernumberSearch" placeholder="회원번호 입력">
            </div>
            <div class="control-panel-row" id="surveySelectRow">
                <label class="control-panel-label" id="surveySelectLabel">데이터 선택</label>
                <select id="surveyIdSelect" onchange="selectSurvey(this.value)">
                    <option value="">선택하세요</option>
                </select>
            </div>
            <div class="btn-group" id="printClearBtnGroup">
                <button class="btn btn-primary btn-half" id="printBtn" onclick="printSurvey()">인쇄</button>
                <button class="btn btn-secondary btn-half" id="clearBtn" onclick="clearAll()">초기화</button>
            </div>
            <div class="btn-group" id="submitEditBtnGroup">
                <button class="btn btn-secondary" onclick="submit_ResearchAll()" id="submitBtn">입력</button>
                <button class="btn btn-secondary" id="editBtn" onclick="updateResearch()">수정</button>
            </div>
        </div>
    </div>

    <script>

        function showAlert(message, callback) {
            let alertOverlay = document.getElementById('alertOverlay');
            if (!alertOverlay) {
                alertOverlay = document.createElement('div');
                alertOverlay.id = 'alertOverlay';
                alertOverlay.className = 'alert-overlay';

                const alertHTML = `
                    <div class="alert-container">
                        <div class="alert-header">알림</div>
                        <div class="alert-body" id="alertMessage"></div>
                        <div class="alert-footer">
                            <button class="alert-btn" id="alertOkBtn">확인</button>
                        </div>
                    </div>
                `;

                alertOverlay.innerHTML = alertHTML;
                document.body.appendChild(alertOverlay);
            }

            const alertMessage = document.getElementById('alertMessage');

            if (message.includes('다음 필수 항목이 입력되지 않았습니다:')) {
                const parts = message.split('다음 필수 항목이 입력되지 않았습니다:\n\n');
                const title = parts[0] + '다음 필수 항목이 입력되지 않았습니다:';

                let items = '';
                if (parts.length > 1) {
                    const itemList = parts[1].split('\n');
                    itemList.forEach(item => {
                        if (item.trim()) {
                            items += `<div class="alert-item">${item.trim()}</div>`;
                        }
                    });
                }

                alertMessage.innerHTML = `${title}<div class="alert-items">${items}</div>`;
            } else {
                alertMessage.textContent = message;
            }

            const alertOkBtn = document.getElementById('alertOkBtn');
            alertOkBtn.onclick = function () {
                alertOverlay.style.display = 'none';
                if (typeof callback === 'function') {
                    callback();
                }
            };

            alertOverlay.style.display = 'flex';
        }

        initialize();

        let tempMemberInfo = [];
        let tempEmployeeInfo = [];

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function updateHeaderTitle(selectedSurveyDate = null) {
            const headerTitle = document.querySelector('.header h1');
            const baseTitle = document.getElementById('fullSurveyBtn').classList.contains('active') ? 
                "우리집데이케어센터 욕구조사_전체조사" : "우리집데이케어센터 욕구조사_필수조사";

            if (selectedSurveyDate) {
                headerTitle.innerHTML = `${baseTitle} <span style="font-size: 0.8em; font-weight: normal;">(${selectedSurveyDate})</span>`;
            } else {
                headerTitle.textContent = baseTitle;
            }
        }

        function renderSurvey(data) {
            const headers = data[0];
            const rows = data.slice(1);

            const surveyContent = document.getElementById('surveyContentContainer');
            if (!surveyContent) {
                return;
            }

            let surveyHtml = '';

            const groupedData = {};
            for (let i = 1; i < data.length; i++) {
                const [mainCategory, subCategory, question, required, inputType, content] = data[i];

                if (!groupedData[mainCategory]) {
                    groupedData[mainCategory] = {};
                }
                if (!groupedData[mainCategory][subCategory]) {
                    groupedData[mainCategory][subCategory] = [];
                }
                groupedData[mainCategory][subCategory].push({
                    question,
                    required,
                    inputType,
                    content
                });
            }

            let finalHtml = '';

            for (const mainCategory in groupedData) {
                let sectionHtml = `<div class="section"><h2>${mainCategory}</h2>`;

                for (const subCategory in groupedData[mainCategory]) {
                    let subsectionHtml = `<div class="subsection"><h3>${subCategory}</h3>`;

                    groupedData[mainCategory][subCategory].forEach(item => {
                        let questionHtml = `<div class="question">`;
                        questionHtml += `<h4>${item.question}${item.required === '필수' ? '<span class="required">*필수</span>' : ''}</h4>`;

                        switch (item.inputType) {
                            case '체크박스':
                                questionHtml += entry_체크박스(item.content);
                                break;
                            case '장문':
                                questionHtml += entry_textarea();
                                break;
                            case '라디오버튼':
                                questionHtml += entry_radio(item.content);
                                break;
                            case '단문':
                                questionHtml += entry_input();
                                break;
                        }

                        questionHtml += '</div>';
                        subsectionHtml += questionHtml;
                    });

                    subsectionHtml += '</div>';
                    sectionHtml += subsectionHtml;
                }

                sectionHtml += '</div>';
                finalHtml += sectionHtml;
            }

            surveyContent.innerHTML = finalHtml;

            document.getElementById('editBtn').disabled = true;
        }

        function entry_체크박스(content) {
            const items = content.split('_');
            let html = '<div class="checkbox-group">';

            items.forEach(item => {
                const randomId = Math.random().toString(36).substr(2, 9);
                if (item.includes('{input}')) {
                    const label = item.replace('{input}', '');
                    html += `<div class="checkbox-item full-width">
                        <div>
                            <input type="checkbox" id="${label}_${randomId}" onchange="toggleInput(this)">
                            <label for="${label}_${randomId}">${label}</label>
                        </div>
                        <input type="text" class="input-field" placeholder="입력해주세요" disabled>
                    </div>`;
                } else if (item.includes('{inputshort}')) {
                    const label = item.replace('{inputshort}', '');
                    html += `<div class="checkbox-item">
                        <input type="checkbox" id="${label}_${randomId}" onchange="toggleInput(this)">
                        <label for="${label}_${randomId}">${label}</label>
                        <input type="text" class="short-input" placeholder="입력" disabled>
                    </div>`;
                } else {
                    html += `<div class="checkbox-item">
                        <input type="checkbox" id="${item}_${randomId}">
                        <label for="${item}_${randomId}">${item}</label>
                    </div>`;
                }
            });

            html += '</div>';
            return html;
        }

        function toggleInput(checkbox) {
            let inputField = null;
            const parentItem = checkbox.closest('.checkbox-item');
            if (parentItem) {
                inputField = parentItem.querySelector('input[type="text"]');
            }

            if (inputField) {
                inputField.disabled = !checkbox.checked;
                if (!checkbox.checked) {
                    inputField.value = '';
                }
            }
        }

        function entry_textarea() {
            return `<textarea class="textarea-field" placeholder="답변을 입력해주세요"></textarea>`;
        }

        function entry_radio(content) {
            const randomName = Math.random().toString(36).substr(2, 9);
            let html = '<div class="radio-group">';

            const items = typeof content === 'string' ? content.split('_') : content;

            items.forEach(item => {
                const randomId = Math.random().toString(36).substr(2, 9);
                if (item.includes('{input}')) {
                    const label = item.replace('{input}', '');
                    html += `<div class="radio-item full-width">
                        <div>
                            <input type="radio" name="radio_${randomName}" id="radio_${randomId}" onchange="toggleRadioInput(this)">
                            <label for="radio_${randomId}">${label}</label>
                        </div>
                        <input type="text" class="input-field" placeholder="입력해주세요" disabled>
                    </div>`;
                } else if (item.includes('{inputshort}')) {
                    const label = item.replace('{inputshort}', '');
                    html += `<div class="radio-item">
                        <input type="radio" name="radio_${randomName}" id="radio_${randomId}" onchange="toggleRadioInput(this)">
                        <label for="radio_${randomId}">${label}</label>
                        <input type="text" class="short-input" placeholder="입력" disabled>
                    </div>`;
                } else {
                    html += `<div class="radio-item">
                        <input type="radio" name="radio_${randomName}" id="radio_${randomId}">
                        <label for="radio_${randomId}">${item}</label>
                    </div>`;
                }
            });

            html += '</div>';
            
            return `<div class="radio-container">
                <button type="button" class="reset-radio-btn no-print" onclick="resetRadioGroup(this)" title="선택 초기화">✕</button>
                ${html}
            </div>`;
        }

        function resetRadioGroup(button) {
            const container = button.closest('.radio-container');
            const radioGroup = container.querySelector('.radio-group');
            
            radioGroup.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            
            radioGroup.querySelectorAll('input[type="text"], .short-input').forEach(input => {
                input.disabled = true;
                input.value = '';
            });
        }

        function toggleRadioInput(radio) {
            const parentItem = radio.closest('.radio-item');
            const inputField = parentItem.querySelector('input[type="text"], .short-input');

            if (inputField) {
                const radioGroup = radio.closest('.radio-group');
                radioGroup.querySelectorAll('input[type="text"], .short-input').forEach(input => {
                    input.disabled = true;
                    input.value = '';
                });

                inputField.disabled = !radio.checked;
            }
        }

        function entry_input() {
            return `<input type="text" class="input-field" placeholder="답변을 입력해주세요">`;
        }

        function printSurvey() {
            const style = document.createElement('style');
            style.id = 'print-styles';
            style.innerHTML = `
                @media print {
                    body {
                        background-color: white;
                    }
                    
                    .header {
                        display: block !important;
                        position: static;
                        box-shadow: none;
                        margin-bottom: 10px;
                        border-bottom: 2px solid #4CAF50;
                    }
                    
                    .control-panel, .page-number {
                        display: none !important;
                    }
                    
                    .no-print, .no-print * {
                        display: none !important;
                    }
                    
                    .section {
                        page-break-before: auto !important;
                        page-break-after: auto !important;
                        background-color: #C8E6C9 !important;
                        print-color-adjust: exact;
                        -webkit-print-color-adjust: exact;
                    }
                    
                    .info-section {
                        page-break-after: auto !important;
                        background-color: #C8E6C9 !important;
                        print-color-adjust: exact;
                        -webkit-print-color-adjust: exact;
                    }
                    
                    .subsection {
                        background-color: #F1F8E9 !important;
                        print-color-adjust: exact;
                        -webkit-print-color-adjust: exact;
                    }
                    
                    .survey-container {
                        box-shadow: none;
                        padding: 0;
                        margin: 0;
                    }
                    
                    .section, .subsection, .question {
                        break-inside: auto !important;
                        page-break-before: auto !important;
                        page-break-after: auto !important;
                    }
                    
                    @page {
                        margin: 1.5cm 1cm;
                    }
                }
            `;
            document.head.appendChild(style);

            window.print();

            setTimeout(() => {
                document.getElementById('print-styles')?.remove();
            }, 1000);
        }

        async function submit_ResearchAll() {
            const memberNo = document.querySelector('.info-section .info-row:first-child .info-group:first-child input').value;
            const memberName = document.querySelector('.info-section .info-row:first-child .info-group:last-child input').value;
            const staffNo = document.querySelector('.info-section .info-row:last-child .info-group:first-child input').value;
            const staffName = document.querySelector('.info-section .info-row:last-child .info-group:last-child input').value;

            if (!memberNo || !memberName) {
                showAlert('회원번호와 회원명은 필수 입력사항입니다.', function () {
                    return;
                });
                return;
            }

            if (!staffNo || !staffName) {
                showAlert('직원번호와 직원명은 필수 입력사항입니다.', function () {
                    return;
                });
                return;
            }

            const missingItems = entryCheck();
            if (missingItems && missingItems.length > 0) {
                return;
            }

            const formData = collectFormData();

            if (!formData || Object.keys(formData).length === 0) {
                showAlert('수집된 설문 데이터가 없습니다. 필수 항목을 모두 입력해주세요.');
                return;
            }

            const now = new Date();
            const year = now.getFullYear().toString().substr(-2);
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const surveyId = `${memberNo}_${year}${month}${day}${hours}${minutes}${seconds}`;

            const submitData = {
                surveyId: surveyId,
                memberNo: memberNo,
                memberName: memberName,
                staffNo: staffNo,
                staffName: staffName,
                formData: formData
            };

            showLoading();
            try {
                const response = await saveResearchData(submitData);
                hideLoading();
                if (response && response.success) {
                    showAlert('설문조사 결과가 성공적으로 저장되었습니다.', function () {
                        allClear();
                    });
                } else {
                    showAlert('설문조사 결과 저장 실패: ' + (response.message || '알 수 없는 오류'));
                }
            } catch (error) {
                hideLoading();
                showAlert('설문조사 결과 저장 중 오류가 발생했습니다: ' + error);
            }
        }

        async function loadMemberSurveys(memberNo) {
            if (!memberNo) {
                showAlert('회원번호를 입력해주세요.');
                return;
            }

            allClear();

            showLoading();
            try {
                const response = await getMemberSurveys(memberNo);
                hideLoading();
                if (!response.success) {
                    showAlert('데이터 로드 실패: ' + response.message, function () {
                        return;
                    });
                    return;
                }

                if (!response.surveys || response.surveys.length === 0) {
                    showAlert('해당 회원의 설문조사 기록이 없습니다.', function () {
                        tempMemberInfo = null;
                        updateSurveyIdSelect([]);
                        return;
                    });
                    return;
                }

                tempMemberInfo = response.surveys;

                const surveyIds = tempMemberInfo.map(survey => {
                    const id = survey.surveyId;
                    let displayId = id;

                    if (id.includes('_')) {
                        const parts = id.split('_');
                        if (parts.length > 1 && parts[1].length === 12) {
                            const timestamp = parts[1];
                            const year = '20' + timestamp.substr(0, 2);
                            const month = timestamp.substr(2, 2);
                            const day = timestamp.substr(4, 2);
                            const hour = timestamp.substr(6, 2);
                            const minute = timestamp.substr(8, 2);
                            const second = timestamp.substr(10, 2);
                            displayId = `${year}-${month}-${day} ${hour}:${minute}:${second}`;
                        }
                    }

                    return {
                        id: survey.surveyId,
                        display: displayId
                    };
                });

                updateSurveyIdSelect(surveyIds);

                if (tempMemberInfo.length > 0) {
                    const latestSurvey = tempMemberInfo[0];
                    document.querySelector('.info-section .info-row:first-child .info-group:first-child input').value = latestSurvey.memberNo;
                    document.querySelector('.info-section .info-row:first-child .info-group:last-child input').value = latestSurvey.memberName;

                    document.getElementById('submitBtn').disabled = false;
                    document.getElementById('editBtn').disabled = true;
                }

                showAlert(`${memberNo} 회원의 설문조사 데이터 ${response.surveys.length}건을 불러왔습니다.`);
            } catch (error) {
                hideLoading();
                showAlert('데이터 로드 중 오류 발생: ' + error);
            }
        }

        function updateSurveyIdSelect(surveyIds) {
            const select = document.getElementById('surveyIdSelect');

            while (select.options.length > 1) {
                select.remove(1);
            }

            surveyIds.forEach(survey => {
                const option = document.createElement('option');
                option.value = survey.id;
                option.textContent = survey.display;
                select.appendChild(option);
            });
        }

        function selectSurvey(surveyId) {
            if (!surveyId || !tempMemberInfo) return;

            const selectedSurvey = tempMemberInfo.find(survey => survey.surveyId === surveyId);

            if (!selectedSurvey) {
                showAlert('선택한 설문조사 데이터를 찾을 수 없습니다.', function () {
                    return;
                });
            }

            const selectElement = document.getElementById('surveyIdSelect');
            const selectedOption = selectElement.options[selectElement.selectedIndex];
            const surveyDate = selectedOption.textContent;

            updateHeaderTitle(surveyDate);

            const controlPanelMemberNo = document.getElementById('entrymembernumberSearch').value;

            allClear();

            document.getElementById('entrymembernumberSearch').value = controlPanelMemberNo;

            document.getElementById('entrymembernumber').value = selectedSurvey.memberNo;
            document.getElementById('entrymembername').value = selectedSurvey.memberName;
            document.getElementById('entryemployeenumber').value = selectedSurvey.staffNo;
            document.getElementById('entryemployeename').value = selectedSurvey.staffName;

            fillFormData(selectedSurvey.formData);

            document.getElementById('submitBtn').disabled = true;
            document.getElementById('editBtn').disabled = false;

            showAlert('선택한 설문조사 데이터를 불러왔습니다.');
        }

        function fillFormData(formData) {
            const questions = document.querySelectorAll('.question');

            questions.forEach(question => {
                const titleElement = question.querySelector('h4');
                if (!titleElement) return;

                const title = titleElement.textContent.replace('*필수', '').trim();

                if (formData[title]) {
                    const value = formData[title];

                    const checkboxes = question.querySelectorAll('input[type="checkbox"]');
                    if (checkboxes.length > 0) {
                        const values = value.includes('_') ? value.split('_') : [value];

                        values.forEach(val => {
                            let checkboxValue = val;
                            let inputValue = '';

                            if (val.includes('[') && val.includes(']')) {
                                const matches = val.match(/(.*)\[(.*)\]/);
                                if (matches && matches.length > 2) {
                                    checkboxValue = matches[1].trim();
                                    inputValue = matches[2];
                                }
                            }

                            for (let i = 0; i < checkboxes.length; i++) {
                                const checkbox = checkboxes[i];
                                const label = checkbox.nextElementSibling.textContent.trim();

                                if (label === checkboxValue) {
                                    checkbox.checked = true;

                                    toggleInput(checkbox);

                                    if (inputValue) {
                                        const parentItem = checkbox.closest('.checkbox-item');
                                        if (parentItem) {
                                            const inputField = parentItem.querySelector('input[type="text"]');
                                            if (inputField) {
                                                inputField.disabled = false;
                                                inputField.value = inputValue;
                                            }
                                        }
                                    }
                                    break;
                                }
                            }
                        });
                    }
                    else if (question.querySelector('.radio-container') || question.querySelectorAll('input[type="radio"]').length > 0) {
                        let radioValue = value;
                        let inputValue = '';

                        if (value.includes('[') && value.includes(']')) {
                            const matches = value.match(/(.*)\[(.*)\]/);
                            if (matches && matches.length > 2) {
                                radioValue = matches[1].trim();
                                inputValue = matches[2];
                            }
                        }

                        const radioContainer = question.querySelector('.radio-container');
                        if (radioContainer) {
                            radioContainer.querySelectorAll('input[type="text"], .short-input').forEach(input => {
                                input.disabled = true;
                                input.value = '';
                            });
                        } else {
                            question.querySelectorAll('input[type="text"], .short-input').forEach(input => {
                                if (input.closest('.radio-item')) {
                                    input.disabled = true;
                                    input.value = '';
                                }
                            });
                        }
                        
                        let radioButtons;
                        if (radioContainer) {
                            radioButtons = radioContainer.querySelectorAll('input[type="radio"]');
                        } else {
                            radioButtons = question.querySelectorAll('input[type="radio"]');
                        }

                        radioButtons.forEach(radio => {
                            radio.checked = false;
                        });

                        radioButtons.forEach(radio => {
                            const label = radio.nextElementSibling.textContent.trim();
                            if (label === radioValue) {
                                radio.checked = true;

                                const parentItem = radio.closest('.radio-item');
                                if (parentItem && inputValue) {
                                    const inputField = parentItem.querySelector('input[type="text"], .short-input');
                                    if (inputField) {
                                        inputField.disabled = false;
                                        inputField.value = inputValue;
                                    }
                                }
                            }
                        });
                    }
                    else if (question.querySelector('textarea')) {
                        const textarea = question.querySelector('textarea');
                        textarea.value = value;
                    }
                    else if (question.querySelector('input.input-field:not([disabled])')) {
                        const inputField = question.querySelector('input.input-field:not([disabled])');
                        inputField.value = value;
                    }
                }
            });
        }

        function togglePanel() {
            const panel = document.getElementById('controlPanel');
            panel.classList.toggle('collapsed');
        }

        async function updateResearch() {
            const memberNo = document.querySelector('.info-section .info-row:first-child .info-group:first-child input').value;
            const memberName = document.querySelector('.info-section .info-row:first-child .info-group:last-child input').value;
            const staffNo = document.querySelector('.info-section .info-row:last-child .info-group:first-child input').value;
            const staffName = document.querySelector('.info-section .info-row:last-child .info-group:last-child input').value;

            if (!memberNo || !memberName) {
                showAlert('회원번호와 회원명은 필수 입력사항입니다.', function () {
                    return;
                });
                return;
            }

            if (!staffNo || !staffName) {
                showAlert('직원번호와 직원명도 필수 입력사항입니다.', function () {
                    return;
                });
                return;
            }

            const surveyIdSelect = document.getElementById('surveyIdSelect');
            const oldSurveyId = surveyIdSelect.value;

            if (!oldSurveyId) {
                showAlert('수정할 설문조사를 선택해주세요.', function () {
                    return;
                });
                return;
            }

            const missingItems = entryCheck();
            if (missingItems.length > 0) {
                return;
            }

            const formData = collectFormData();

            const now = new Date();
            const year = now.getFullYear().toString().substr(-2);
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const newSurveyId = `${memberNo}_${year}${month}${day}${hours}${minutes}${seconds}`;

            const updateData = {
                oldSurveyId: oldSurveyId,
                newSurveyId: newSurveyId,
                memberNo: memberNo,
                memberName: memberName,
                staffNo: staffNo,
                staffName: staffName,
                formData: formData
            };

            showAlert('기존 설문조사 데이터를 수정하시겠습니까?', function () {
                showLoading();
                (async function() {
                    try {
                        const response = await updateResearchData(updateData);
                        hideLoading();
                        if (response && response.success) {
                            showAlert('설문조사 결과가 성공적으로 수정되었습니다.', function () {
                                allClear();
                                loadMemberSurveys(memberNo);
                            });
                        } else {
                            showAlert('설문조사 결과 수정 실패: ' + (response.message || '알 수 없는 오류'));
                        }
                    } catch (error) {
                        hideLoading();
                        showAlert('설문조사 결과 수정 중 오류가 발생했습니다: ' + error);
                    }
                })();
            });
        }

        function clearAll() {
            document.querySelector('.control-panel-body .control-panel-row input[placeholder="회원번호 입력"]').value = '';

            const surveyIdSelect = document.getElementById('surveyIdSelect');
            if (surveyIdSelect) {
                surveyIdSelect.innerHTML = '<option value="">선택하세요</option>';
                surveyIdSelect.value = '';
            }

            updateHeaderTitle();

            tempMemberInfo = null;

            allClear();
        }

        function allClear() {
            document.querySelectorAll('.info-section input').forEach(input => {
                input.value = '';
            });

            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });

            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });

            document.querySelectorAll('.checkbox-item input[type="text"]').forEach(input => {
                input.value = '';
                input.disabled = true;
            });

            document.querySelectorAll('.question input.input-field:not(.checkbox-item input)').forEach(input => {
                input.value = '';
            });

            document.querySelectorAll('textarea').forEach(textarea => {
                textarea.value = '';
            });

            document.getElementById('submitBtn').disabled = false;
            document.getElementById('editBtn').disabled = true;
        }

        function collectFormData() {
            const result = {};

            const questions = document.querySelectorAll('.question');

            questions.forEach(question => {
                const titleElement = question.querySelector('h4');
                if (!titleElement) return;

                const title = titleElement.textContent.replace('*필수', '').trim();
                let isAnswered = false;

                const checkboxes = question.querySelectorAll('input[type="checkbox"]');
                if (checkboxes.length > 0 && Array.from(checkboxes).some(cb => cb.checked)) {
                    const selectedItems = [];

                    checkboxes.forEach(checkbox => {
                        if (checkbox.checked) {
                            let valueText = checkbox.nextElementSibling.textContent.trim();

                            const parentItem = checkbox.closest('.checkbox-item');

                            if (parentItem) {
                                const inputField = parentItem.querySelector('input[type="text"], .short-input');

                                if (inputField && !inputField.disabled && inputField.value) {
                                    valueText = `${valueText}[${inputField.value}]`;
                                }
                            }
                            selectedItems.push(valueText);
                        }
                    });

                    if (selectedItems.length > 0) {
                        result[title] = selectedItems.join('_');
                        isAnswered = true;
                    }
                }

                if (!isAnswered) {
                    const radioContainer = question.querySelector('.radio-container');
                    if (radioContainer) {
                        const checkedRadio = radioContainer.querySelector('input[type="radio"]:checked');
                        if (checkedRadio) {
                            let valueText = checkedRadio.nextElementSibling.textContent.trim();

                            const parentItem = checkedRadio.closest('.radio-item');

                            if (parentItem) {
                                const inputField = parentItem.querySelector('input[type="text"], .short-input');

                                if (inputField && !inputField.disabled && inputField.value) {
                                    valueText = `${valueText}[${inputField.value}]`;
                                }
                            }

                            result[title] = valueText;
                            isAnswered = true;
                        }
                    } else {
                        const checkedRadio = question.querySelector('input[type="radio"]:checked');
                        if (checkedRadio) {
                            let valueText = checkedRadio.nextElementSibling.textContent.trim();

                            const parentItem = checkedRadio.closest('.radio-item');

                            if (parentItem) {
                                const inputField = parentItem.querySelector('input[type="text"], .short-input');

                                if (inputField && !inputField.disabled && inputField.value) {
                                    valueText = `${valueText}[${inputField.value}]`;
                                }
                            }

                            result[title] = valueText;
                            isAnswered = true;
                        }
                    }
                }

                if (!isAnswered) {
                    const textarea = question.querySelector('textarea');
                    if (textarea && textarea.value.trim()) {
                        result[title] = textarea.value.trim();
                        isAnswered = true;
                    }
                }

                if (!isAnswered) {
                    const standalone_input = Array.from(question.querySelectorAll('input.input-field:not([disabled])'))
                        .find(input => !input.closest('.checkbox-item'));

                    if (standalone_input && standalone_input.value.trim()) {
                        result[title] = standalone_input.value.trim();
                    }
                }
            });

            return result;
        }

        function entryCheck() {
            const missingItems = [];

            document.querySelectorAll('.question h4 .required').forEach(requiredMark => {
                const questionTitle = requiredMark.parentElement.textContent.replace('*필수', '').trim();
                const questionElement = requiredMark.closest('.question');
                let isAnswered = false;

                const checkboxes = questionElement.querySelectorAll('input[type="checkbox"]');
                if (checkboxes.length > 0) {
                    isAnswered = Array.from(checkboxes).some(checkbox => checkbox.checked);
                }

                const radioContainer = questionElement.querySelector('.radio-container');
                if (radioContainer) {
                    const radios = radioContainer.querySelectorAll('input[type="radio"]');
                    if (radios.length > 0) {
                        isAnswered = Array.from(radios).some(radio => radio.checked);
                    }
                } 
                else {
                    const radios = questionElement.querySelectorAll('input[type="radio"]');
                    if (radios.length > 0) {
                        isAnswered = Array.from(radios).some(radio => radio.checked);
                    }
                }

                const textInputs = questionElement.querySelectorAll('input[type="text"]:not([disabled])');
                if (textInputs.length > 0) {
                    isAnswered = Array.from(textInputs).some(input => input.value.trim() !== '');
                }

                const textareas = questionElement.querySelectorAll('textarea');
                if (textareas.length > 0) {
                    isAnswered = Array.from(textareas).some(textarea => textarea.value.trim() !== '');
                }

                if (!isAnswered) {
                    missingItems.push(questionTitle);
                }
            });

            if (missingItems.length > 0) {
                let message = '다음 필수 항목이 입력되지 않았습니다:\n\n';
                missingItems.forEach((item, index) => {
                    message += `${index + 1}. ${item}\n`;
                });
                showAlert(message);
            }

            return missingItems;
        }

        function openRequiredSurvey() {
            showLoading();
            getSelectedData().then(data => {
                renderSurvey(data);
                const headerTitle = document.querySelector('.header h1');
                headerTitle.textContent = "우리집데이케어센터 욕구조사_필수조사";
                
                document.getElementById('requiredSurveyBtn').classList.add('active');
                document.getElementById('fullSurveyBtn').classList.remove('active');
                
                hideLoading();
            }).catch(error => {
                hideLoading();
                showAlert('필수 설문조사 데이터 로드 실패: ' + error);
            });
            return false;
        }

        function openFullSurvey() {
            showLoading();
            getData().then(data => {
                renderSurvey(data);
                const headerTitle = document.querySelector('.header h1');
                headerTitle.textContent = "우리집데이케어센터 욕구조사_전체조사";
                
                document.getElementById('requiredSurveyBtn').classList.remove('active');
                document.getElementById('fullSurveyBtn').classList.add('active');
                
                hideLoading();
            }).catch(error => {
                hideLoading();
                showAlert('전체 설문조사 데이터 로드 실패: ' + error);
            });
            return false;
        }

        function setupEventListeners() {
            const entrymembernumber = document.getElementById('entrymembernumber');

            if (entrymembernumber) {
                entrymembernumber.addEventListener('click', function () {
                    showMemberSelectModal('entrymembernumber');
                });

                entrymembernumber.onclick = function () {};
            } else {
                const similarInputs = Array.from(document.querySelectorAll('input'))
                    .filter(input => input.id && input.id.includes('member'));
            }

            const entryemployeenumber = document.getElementById('entryemployeenumber');

            if (entryemployeenumber) {
                entryemployeenumber.addEventListener('click', function () {
                    showEmployeeSelectModal();
                });

                entryemployeenumber.onclick = function () {};
            } else {
                const similarInputs = Array.from(document.querySelectorAll('input'))
                    .filter(input => input.id && input.id.includes('employee'));
            }

            const entrymembernumberSearch = document.getElementById('entrymembernumberSearch');

            if (entrymembernumberSearch) {
                entrymembernumberSearch.removeAttribute('onchange');

                entrymembernumberSearch.addEventListener('click', function () {
                    showMemberSelectModal('entrymembernumberSearch');
                });

                entrymembernumberSearch.onclick = function () {};

                entrymembernumberSearch.addEventListener('change', function () {
                    if (typeof loadMemberSurveys === 'function') {
                        loadMemberSurveys(this.value);
                    }
                });
            }

            const memberModalClose = document.getElementById('memberModalClose');
            if (memberModalClose) {
                memberModalClose.addEventListener('click', function () {
                    closeMemberSelectModal();
                });
            }

            const cancelMemberSelectBtn = document.getElementById('cancelMemberSelectBtn');
            if (cancelMemberSelectBtn) {
                cancelMemberSelectBtn.addEventListener('click', function () {
                    closeMemberSelectModal();
                });
            }

            const employeeModalClose = document.getElementById('employeeModalClose');
            if (employeeModalClose) {
                employeeModalClose.addEventListener('click', function () {
                    closeEmployeeSelectModal();
                });
            }

            const cancelEmployeeSelectBtn = document.getElementById('cancelEmployeeSelectBtn');
            if (cancelEmployeeSelectBtn) {
                cancelEmployeeSelectBtn.addEventListener('click', function () {
                    closeEmployeeSelectModal();
                });
            }

            if (!document.getElementById('memberSelectModal') || !document.getElementById('employeeSelectModal')) {
                const modalElements = document.querySelectorAll('.modal-overlay, .modal');
                modalElements.forEach((el, idx) => {});
            }
        }

        let membersList = [];
        let selectedMember = null;
        let employeesList = [];
        let selectedEmployee = null;
        let currentMemberTargetId = null;

        async function loadMembersData() {
            showLoading();
            try {
                const data = await getMemberData();
                if (data && data.length > 0) {
                    membersList = data.map(member => {
                        return {
                            memberNo: member.회원번호,
                            memberName: member.회원명
                        };
                    });

                    membersList.sort((a, b) => a.memberName.localeCompare(b.memberName, 'ko-KR'));

                    if (document.getElementById('memberSelectModal').style.display === 'flex') {
                        renderMembersList();
                    }
                }
                hideLoading();
            } catch (error) {
                hideLoading();
                showAlert('회원 목록을 가져오는 데 실패했습니다: ' + error);
            }
        }

        function showMemberSelectModal(targetId) {
            currentMemberTargetId = targetId || 'entrymembernumber';

            const memberList = document.getElementById('memberList');

            if (!memberList) {
                return;
            }

            memberList.innerHTML = '';
            selectedMember = null;

            if (!membersList || membersList.length === 0) {
                loadMembersData();
                memberList.innerHTML = '<div class="no-items">회원 정보를 불러오는 중...</div>';
                return;
            }

            renderMembersList();

            const searchInput = document.getElementById('memberSearchInput');
            if (searchInput) {
                searchInput.value = '';
            }

            const memberSelectModal = document.getElementById('memberSelectModal');

            if (memberSelectModal) {
                memberSelectModal.style.display = 'flex';
            }
        }

        function renderMembersList() {
            const memberList = document.getElementById('memberList');

            if (!memberList) {
                return;
            }

            memberList.innerHTML = '';

            membersList.forEach(member => {
                const memberItem = document.createElement('div');
                memberItem.className = 'modal-item';
                memberItem.innerHTML = `<strong>${member.memberNo}</strong> ${member.memberName}`;
                
                memberItem.setAttribute('data-member-number', member.memberNo);
                memberItem.setAttribute('data-member-name', member.memberName);

                memberItem.addEventListener('click', function () {
                    document.querySelectorAll('#memberList .modal-item.selected').forEach(item => {
                        item.classList.remove('selected');
                    });

                    this.classList.add('selected');
                    selectedMember = member;
                });

                memberItem.addEventListener('dblclick', function () {
                    selectMemberForTarget(member);
                });

                memberList.appendChild(memberItem);
            });
        }

        function resetSurveyForm() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;

                const parentDiv = checkbox.closest('.checkbox-item');
                if (parentDiv) {
                    const inputField = parentDiv.querySelector('input[type="text"]');
                    if (inputField) {
                        inputField.disabled = true;
                        inputField.value = '';
                    }
                }
            });

            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });

            document.querySelectorAll('.question input[type="text"], textarea').forEach(input => {
                input.value = '';
            });

            const editBtn = document.getElementById('editBtn');
            if (editBtn) {
                editBtn.disabled = true;
            }

            const submitBtn = document.getElementById('submitBtn');
            if (submitBtn) {
                submitBtn.disabled = false;
            }
        }

        function selectMemberForTarget(member) {
            if (!member) return;

            if (currentMemberTargetId === 'entrymembernumber') {
                document.getElementById('entrymembernumber').value = member.memberNo;
                document.getElementById('entrymembername').value = member.memberName;

                resetSurveyForm();
            } else if (currentMemberTargetId === 'entrymembernumberSearch') {
                document.getElementById('entrymembernumberSearch').value = member.memberNo;
                if (typeof loadMemberSurveys === 'function') {
                    loadMemberSurveys(member.memberNo);
                }
            } else {
                const targetInput = document.getElementById(currentMemberTargetId);
                if (targetInput) {
                    targetInput.value = member.memberNo;
                }
            }

            closeMemberSelectModal();
        }

        function selectEmployee(employeeNumber, employeeName) {
            document.getElementById('entryemployeenumber').value = employeeNumber;
            document.getElementById('entryemployeename').value = employeeName;

            resetSurveyForm();

            closeEmployeeSelectModal();
        }

        function closeMemberSelectModal() {
            document.getElementById('memberSelectModal').style.display = 'none';
        }

        function closeEmployeeSelectModal() {
            document.getElementById('employeeSelectModal').style.display = 'none';
        }

        function searchEmployees() {
            const searchInput = document.getElementById('employeeSearchInput').value.toLowerCase();
            const employeeItems = document.querySelectorAll('#employeeList .modal-item');

            let hasVisible = false;

            employeeItems.forEach(item => {
                const employeeNo = item.getAttribute('data-employee-number')?.toLowerCase() || '';
                const employeeName = item.getAttribute('data-employee-name')?.toLowerCase() || '';
                const text = item.textContent.toLowerCase();
                
                if (employeeNo.includes(searchInput) || employeeName.includes(searchInput) || text.includes(searchInput)) {
                    item.style.display = 'block';
                    hasVisible = true;
                } else {
                    item.style.display = 'none';
                }
            });

            if (!hasVisible && employeeItems.length > 0) {
                const employeeList = document.getElementById('employeeList');

                if (!document.querySelector('#employeeList .no-search-results')) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-items no-search-results';
                    noResults.textContent = '검색 결과가 없습니다.';
                    employeeList.appendChild(noResults);
                }
            } else {
                const noResults = document.querySelector('#employeeList .no-search-results');
                if (noResults) {
                    noResults.remove();
                }
            }
        }

        async function loadEmployeeData() {
            showLoading();
            try {
                const data = await getEmployeeData();
                if (data && data.length > 0) {
                    employeesList = data.map(employee => {
                        return {
                            employeeNo: employee.직원번호,
                            employeeName: employee.직원명
                        };
                    });

                    employeesList.sort((a, b) => a.employeeName.localeCompare(b.employeeName, 'ko-KR'));

                    if (document.getElementById('employeeSelectModal').style.display === 'flex') {
                        renderEmployeeList();
                    }
                }
                hideLoading();
            } catch (error) {
                hideLoading();
                showAlert('직원 목록을 가져오는 데 실패했습니다: ' + error);
            }
        }

        function showEmployeeSelectModal() {
            const employeeList = document.getElementById('employeeList');

            if (!employeeList) {
                return;
            }

            employeeList.innerHTML = '';
            selectedEmployee = null;

            if (!employeesList || employeesList.length === 0) {
                loadEmployeeData();
                employeeList.innerHTML = '<div class="no-items">직원 정보를 불러오는 중...</div>';
                return;
            }

            renderEmployeeList();

            const searchInput = document.getElementById('employeeSearchInput');
            if (searchInput) {
                searchInput.value = '';
            }

            const employeeSelectModal = document.getElementById('employeeSelectModal');

            if (employeeSelectModal) {
                employeeSelectModal.style.display = 'flex';
            }
        }

        function renderEmployeeList() {
            const employeeList = document.getElementById('employeeList');

            if (!employeeList) {
                return;
            }

            employeeList.innerHTML = '';

            employeesList.forEach(employee => {
                const employeeItem = document.createElement('div');
                employeeItem.className = 'modal-item';
                employeeItem.innerHTML = `<strong>${employee.employeeNo}</strong> ${employee.employeeName}`;
                
                employeeItem.setAttribute('data-employee-number', employee.employeeNo);
                employeeItem.setAttribute('data-employee-name', employee.employeeName);

                employeeItem.addEventListener('click', function () {
                    document.querySelectorAll('#employeeList .modal-item.selected').forEach(item => {
                        item.classList.remove('selected');
                    });

                    this.classList.add('selected');
                    selectedEmployee = employee;
                });

                employeeItem.addEventListener('dblclick', function () {
                    selectEmployee(employee.employeeNo, employee.employeeName);
                });

                employeeList.appendChild(employeeItem);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            setupEventListeners();

            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') {
                    if (document.getElementById('memberSelectModal').style.display === 'flex') {
                        closeMemberSelectModal();
                    }
                    if (document.getElementById('employeeSelectModal').style.display === 'flex') {
                        closeEmployeeSelectModal();
                    }
                }
            });
        });

        function initialize() {
            showLoading();
            getData().then(data => {
                renderSurvey(data);
                
                document.getElementById('fullSurveyBtn').classList.add('active');
                document.getElementById('requiredSurveyBtn').classList.remove('active');
                
                hideLoading();
            }).catch(error => {
                hideLoading();
                showAlert('설문조사 데이터 로드 실패: ' + error);
            });

            updateHeaderTitle();

            loadMembersData();

            loadEmployeeData();
        }

        function setupEventListeners() {
            const entrymembernumber = document.getElementById('entrymembernumber');

            if (entrymembernumber) {
                entrymembernumber.addEventListener('click', function () {
                    showMemberSelectModal('entrymembernumber');
                });

                entrymembernumber.onclick = function () {};
            } else {
                const similarInputs = Array.from(document.querySelectorAll('input'))
                    .filter(input => input.id && input.id.includes('member'));
            }

            const entryemployeenumber = document.getElementById('entryemployeenumber');

            if (entryemployeenumber) {
                entryemployeenumber.addEventListener('click', function () {
                    showEmployeeSelectModal();
                });

                entryemployeenumber.onclick = function () {};
            } else {
                const similarInputs = Array.from(document.querySelectorAll('input'))
                    .filter(input => input.id && input.id.includes('employee'));
            }

            const entrymembernumberSearch = document.getElementById('entrymembernumberSearch');

            if (entrymembernumberSearch) {
                entrymembernumberSearch.removeAttribute('onchange');

                entrymembernumberSearch.addEventListener('click', function () {
                    showMemberSelectModal('entrymembernumberSearch');
                });

                entrymembernumberSearch.onclick = function () {};

                entrymembernumberSearch.addEventListener('change', function () {
                    if (typeof loadMemberSurveys === 'function') {
                        loadMemberSurveys(this.value);
                    }
                });
            }

            const memberModalClose = document.getElementById('memberModalClose');
            if (memberModalClose) {
                memberModalClose.addEventListener('click', function () {
                    closeMemberSelectModal();
                });
            }

            const cancelMemberSelectBtn = document.getElementById('cancelMemberSelectBtn');
            if (cancelMemberSelectBtn) {
                cancelMemberSelectBtn.addEventListener('click', function () {
                    closeMemberSelectModal();
                });
            }

            const selectMemberBtn = document.getElementById('selectMemberBtn');
            if (selectMemberBtn) {
                selectMemberBtn.addEventListener('click', function () {
                    if (selectedMember) {
                        selectMemberForTarget(selectedMember);
                    } else {
                        showAlert('회원을 선택해주세요.');
                    }
                });
            }

            const employeeModalClose = document.getElementById('employeeModalClose');
            if (employeeModalClose) {
                employeeModalClose.addEventListener('click', function () {
                    closeEmployeeSelectModal();
                });
            }

            const cancelEmployeeSelectBtn = document.getElementById('cancelEmployeeSelectBtn');
            if (cancelEmployeeSelectBtn) {
                cancelEmployeeSelectBtn.addEventListener('click', function () {
                    closeEmployeeSelectModal();
                });
            }

            const selectEmployeeBtn = document.getElementById('selectEmployeeBtn');
            if (selectEmployeeBtn) {
                selectEmployeeBtn.addEventListener('click', function () {
                    const selectedItem = document.querySelector('#employeeList .modal-item.selected');
                    if (selectedItem) {
                        const employeeNumber = selectedItem.getAttribute('data-employee-number');
                        const employeeName = selectedItem.getAttribute('data-employee-name');
                        selectEmployee(employeeNumber, employeeName);
                    } else {
                        showAlert('직원을 선택해주세요.');
                    }
                });
            }
        }

        function searchMembers() {
            const searchInput = document.getElementById('memberSearchInput').value.toLowerCase();
            const memberItems = document.querySelectorAll('#memberList .modal-item');

            let hasVisible = false;

            memberItems.forEach(item => {
                const memberNo = item.getAttribute('data-member-number')?.toLowerCase() || '';
                const memberName = item.getAttribute('data-member-name')?.toLowerCase() || '';
                const text = item.textContent.toLowerCase();
                
                if (memberNo.includes(searchInput) || memberName.includes(searchInput) || text.includes(searchInput)) {
                    item.style.display = 'block';
                    hasVisible = true;
                } else {
                    item.style.display = 'none';
                }
            });

            if (!hasVisible && memberItems.length > 0) {
                const memberList = document.getElementById('memberList');

                if (!document.querySelector('#memberList .no-search-results')) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-items no-search-results';
                    noResults.textContent = '검색 결과가 없습니다.';
                    memberList.appendChild(noResults);
                }
            } else {
                const noResults = document.querySelector('#memberList .no-search-results');
                if (noResults) {
                    noResults.remove();
                }
            }
        }

    </script>
</body>

</html>